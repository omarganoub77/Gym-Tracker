<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gym Tracker">
    <meta name="theme-color" content="#0f172a">
    <title>Gym Tracker</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkd5bSBUcmFja2VyIiwKICAic2hvcnRfbmFtZSI6ICJHeW0iLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBmMTcyYSIsCiAgInRoZW1lX2NvbG9yIjogIiMzYjgyZjYiCn0=">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { overscroll-behavior: none; background-color: #020617; }
        input, textarea { font-size: 16px !important; }
        .animate-fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-950 text-white font-sans">
    <div id="app"></div>

    <script>
        const defaultWorkouts = {
            upper1: { id: 'upper1', name: 'Upper 1', subtitle: 'Strength Focus', color: 'bg-red-500', exercises: [{ id: 'u1e1', name: 'Dumbbell Bench Press', sets: 4, reps: '6-8', muscle: 'Chest' }, { id: 'u1e2', name: 'Cable Row', sets: 4, reps: '6-8', muscle: 'Back' }, { id: 'u1e3', name: 'Overhead Press', sets: 3, reps: '8-10', muscle: 'Shoulders' }] },
            lower1: { id: 'lower1', name: 'Lower 1', subtitle: 'Strength Focus', color: 'bg-blue-500', exercises: [{ id: 'l1e1', name: 'Belt Squat', sets: 4, reps: '6-8', muscle: 'Quads' }, { id: 'l1e2', name: 'Romanian Deadlift', sets: 3, reps: '8-10', muscle: 'Hamstrings' }] },
            plyo: { id: 'plyo', name: 'Plyo/Power', subtitle: 'Conditioning', color: 'bg-purple-500', exercises: [{ id: 'p1', name: 'Box Jumps', sets: 4, reps: '8', muscle: 'Power' }] },
            upper2: { id: 'upper2', name: 'Upper 2', subtitle: 'Hypertrophy', color: 'bg-orange-500', exercises: [{ id: 'u2e1', name: 'Incline Press', sets: 4, reps: '10-12', muscle: 'Chest' }] },
            lower2: { id: 'lower2', name: 'Lower 2', subtitle: 'Hypertrophy', color: 'bg-green-500', exercises: [{ id: 'l2e1', name: 'Leg Press', sets: 4, reps: '12-15', muscle: 'Quads' }] }
        };

        class GymApp {
            constructor() {
                this.workouts = JSON.parse(localStorage.getItem('gymWorkouts')) || defaultWorkouts;
                this.workoutHistory = JSON.parse(localStorage.getItem('gymHistory')) || [];
                this.currentWorkout = null;
                this.activeExercise = null;
                this.workoutSession = null;
                this.editMode = false;
                this.editingExercise = null;
                this.editingWorkoutHeader = null;
                this.showMenu = false;
                this.render();
            }

            save() {
                localStorage.setItem('gymWorkouts', JSON.stringify(this.workouts));
                localStorage.setItem('gymHistory', JSON.stringify(this.workoutHistory));
            }

            startWorkout(workoutId) {
                this.currentWorkout = this.workouts[workoutId];
                this.workoutSession = { startTime: new Date().toISOString(), workoutId: workoutId, exercises: {} };
                this.render();
            }

            finishWorkout() {
                const history = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    workoutName: this.currentWorkout.name,
                    exercises: this.workoutSession.exercises
                };
                this.workoutHistory = [history, ...this.workoutHistory];
                this.save();
                this.currentWorkout = null;
                this.workoutSession = null;
                this.render();
            }

            render() {
                const app = document.getElementById('app');
                if (this.editingWorkoutHeader) {
                    app.innerHTML = this.renderWorkoutHeaderEdit();
                } else if (this.editingExercise) {
                    app.innerHTML = this.renderExerciseEdit();
                } else if (this.activeExercise) {
                    app.innerHTML = this.renderExerciseDetail();
                } else if (this.currentWorkout) {
                    app.innerHTML = this.renderWorkoutList();
                } else {
                    app.innerHTML = this.renderHome();
                }
            }

            renderHome() {
                const workoutCards = Object.values(this.workouts).map(workout => `
                    <div class="bg-slate-800 rounded-xl overflow-hidden shadow-lg border border-slate-700/50 mb-4">
                        <div class="p-5 flex items-center justify-between">
                            <button onclick="app.startWorkout('${workout.id}')" class="flex items-center gap-4 flex-1 text-left ${this.editMode ? 'opacity-50 pointer-events-none' : ''}">
                                <div class="${workout.color} w-12 h-12 rounded-lg flex items-center justify-center text-2xl shadow-inner">üèãÔ∏è</div>
                                <div>
                                    <h3 class="text-xl font-bold">${workout.name}</h3>
                                    <p class="text-slate-400 text-sm">${workout.subtitle}</p>
                                </div>
                            </button>
                            ${this.editMode ? `<button onclick="app.editingWorkoutHeader = '${workout.id}'; app.render()" class="bg-blue-600/20 text-blue-400 px-3 py-1 rounded text-xs font-bold uppercase">Rename</button>` : ''}
                        </div>
                        ${this.editMode ? this.renderEditExercises(workout) : ''}
                    </div>
                `).join('');

                const historySection = this.workoutHistory.length > 0 ? `
                    <div class="p-4 mt-4">
                        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">üïí Recent History</h2>
                        <div class="space-y-3">
                            ${this.workoutHistory.slice(0, 5).map(w => `
                                <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700/50">
                                    <div class="flex justify-between items-center">
                                        <span class="font-bold">${w.workoutName}</span>
                                        <span class="text-xs text-slate-500">${new Date(w.date).toLocaleDateString()}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>` : '';

                return `
                    <div class="min-h-screen pb-20 animate-fade-in">
                        <div class="bg-gradient-to-br from-blue-700 via-blue-600 to-indigo-700 p-6 pb-12 rounded-b-[2rem] shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <h1 class="text-3xl font-black tracking-tight">GYM TRACKER</h1>
                                <button onclick="app.showMenu = !app.showMenu; app.render()" class="bg-white/10 p-2 rounded-lg">‚öôÔ∏è</button>
                            </div>
                            <p class="text-blue-100 font-medium">Ready for your session, Gymbro?</p>
                        </div>
                        ${this.showMenu ? `<div class="p-4 -mt-6"><button onclick="app.editMode = !app.editMode; app.showMenu = false; app.render()" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl flex items-center justify-center gap-3 font-bold shadow-2xl">${this.editMode ? 'Finish Customizing' : 'Customize Workouts'}</button></div>` : '<div class="h-6"></div>'}
                        <div class="px-4">${workoutCards}</div>
                        ${historySection}
                    </div>`;
            }

            renderEditExercises(workout) {
                return `<div class="p-4 bg-slate-900/80 space-y-2 border-t border-slate-700/50">
                    ${workout.exercises.map(ex => `
                        <div class="flex items-center justify-between bg-slate-800 p-3 rounded-lg border border-slate-700">
                            <div><div class="text-white font-bold text-sm">${ex.name}</div><div class="text-slate-400 text-xs">${ex.sets} sets ‚Ä¢ ${ex.reps} reps</div></div>
                            <div class="flex gap-2">
                                <button onclick="app.editingExercise = { workoutId: '${workout.id}', exercise: ${JSON.stringify(ex).replace(/"/g, '&quot;')} }; app.render()" class="bg-blue-500/10 text-blue-400 p-2 rounded text-xs font-bold uppercase">Edit</button>
                                <button onclick="app.deleteExercise('${workout.id}', '${ex.id}')" class="bg-red-500/10 text-red-400 p-2 rounded text-xs font-bold uppercase">‚úï</button>
                            </div>
                        </div>`).join('')}
                    <button onclick="app.addExercise('${workout.id}')" class="w-full bg-blue-600/10 text-blue-400 p-3 rounded-lg border border-blue-600/20 font-bold text-sm">+ Add New Exercise</button>
                </div>`;
            }

            renderWorkoutHeaderEdit() {
                const w = this.workouts[this.editingWorkoutHeader];
                return `<div class="fixed inset-0 bg-black/90 flex items-center justify-center p-6 z-50 animate-fade-in"><div class="bg-slate-800 p-6 rounded-3xl w-full max-w-md border border-slate-700">
                    <h2 class="text-xl font-black mb-6 uppercase">Rename Workout</h2>
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Workout Name</label>
                    <input id="hName" type="text" value="${w.name}" class="w-full bg-slate-900 p-4 rounded-xl mb-4 border border-slate-700 outline-none">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Subtitle</label>
                    <input id="hSub" type="text" value="${w.subtitle}" class="w-full bg-slate-900 p-4 rounded-xl mb-6 border border-slate-700 outline-none">
                    <button onclick="app.saveWorkoutHeader()" class="w-full bg-blue-600 p-4 rounded-xl font-black mb-2 shadow-lg">SAVE CHANGES</button>
                    <button onclick="app.editingWorkoutHeader = null; app.render()" class="w-full text-slate-500 font-bold py-2">CANCEL</button>
                </div></div>`;
            }

            renderWorkoutList() {
                const exerciseCards = this.currentWorkout.exercises.map(exercise => {
                    const sessionData = this.workoutSession.exercises[exercise.id];
                    const isComplete = sessionData?.completed;
                    return `<div class="w-full bg-slate-800 rounded-xl p-4 flex items-center gap-4 mb-3 border border-slate-700/50 shadow-sm">
                        <button onclick="app.activeExercise = ${JSON.stringify(exercise).replace(/"/g, '&quot;')}; app.render()" class="flex-1 text-left">
                            <h3 class="font-bold text-lg">${exercise.name}</h3>
                            <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">${exercise.sets} SETS ‚Ä¢ ${exercise.reps} REPS</div>
                        </button>
                        <button onclick="app.toggleExerciseQuick('${exercise.id}', event)" class="text-3xl">${isComplete ? '‚úÖ' : '‚ö™'}</button>
                    </div>`;
                }).join('');
                return `<div class="min-h-screen pb-24 animate-fade-in">
                    <div class="${this.currentWorkout.color} p-6 rounded-b-2xl shadow-xl mb-4">
                        <button onclick="app.currentWorkout = null; app.workoutSession = null; app.render()" class="mb-4 bg-black/20 px-3 py-1 rounded-full text-[10px] font-bold">‚Üê QUIT SESSION</button>
                        <h1 class="text-2xl font-black">${this.currentWorkout.name}</h1>
                        <p class="text-white/80 text-sm font-medium">${this.currentWorkout.subtitle}</p>
                    </div>
                    <div class="px-4">${exerciseCards}</div>
                    <div class="fixed bottom-0 left-0 right-0 p-4 bg-slate-950/80 backdrop-blur-lg border-t border-slate-800">
                        <button onclick="app.finishWorkout()" class="w-full bg-green-600 py-4 rounded-2xl font-black shadow-lg">FINISH WORKOUT</button>
                    </div>
                </div>`;
            }

            renderExerciseDetail() {
                const sessionData = this.workoutSession.exercises[this.activeExercise.id] || { weight: '', notes: '', completed: false };
                return `<div class="min-h-screen p-6 animate-fade-in">
                    <button onclick="app.activeExercise = null; app.render()" class="mb-6 font-bold text-slate-400 uppercase text-xs tracking-widest">‚Üê Back to List</button>
                    <h1 class="text-3xl font-black mb-1">${this.activeExercise.name}</h1>
                    <p class="text-slate-500 font-bold mb-8 uppercase tracking-widest text-sm">${this.activeExercise.sets} Sets x ${this.activeExercise.reps} Reps</p>
                    <div class="space-y-6">
                        <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <label class="block text-[10px] font-black text-slate-500 uppercase mb-2">Weight (kg)</label>
                            <input type="number" id="weightInput" value="${sessionData.weight}" placeholder="0" class="w-full bg-slate-900 text-4xl font-black p-4 rounded-xl border border-slate-700 outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <label class="block text-[10px] font-black text-slate-500 uppercase mb-2">Notes</label>
                            <textarea id="notesInput" placeholder="Add notes..." class="w-full bg-slate-900 p-4 rounded-xl border border-slate-700 h-24 outline-none resize-none focus:ring-2 focus:ring-blue-500">${sessionData.notes || ''}</textarea>
                        </div>
                        <button onclick="app.saveDetailsAndBack()" class="w-full bg-blue-600 py-5 rounded-2xl font-black text-xl shadow-xl">LOG EXERCISE</button>
                    </div>
                </div>`;
            }

            renderExerciseEdit() {
                const ex = this.editingExercise.exercise;
                return `<div class="fixed inset-0 bg-black/95 flex items-center justify-center p-6 z-50 animate-fade-in"><div class="bg-slate-800 p-6 rounded-3xl w-full border border-slate-700">
                    <h2 class="text-xl font-black mb-6 uppercase">Edit Exercise</h2>
                    <input type="text" id="editExName" value="${ex.name}" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-700 mb-4 outline-none">
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div><label class="text-[10px] font-bold text-slate-500">SETS</label><input type="number" id="editExSets" value="${ex.sets}" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-700 outline-none"></div>
                        <div><label class="text-[10px] font-bold text-slate-500">REPS</label><input type="text" id="editExReps" value="${ex.reps}" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-700 outline-none"></div>
                    </div>
                    <button onclick="app.saveExEdit()" class="w-full bg-blue-600 p-4 rounded-xl font-black mb-2 shadow-lg">UPDATE</button>
                    <button onclick="app.editingExercise = null; app.render()" class="w-full text-slate-500 font-bold py-2">CANCEL</button>
                </div></div>`;
            }

            saveWorkoutHeader() {
                const w = this.workouts[this.editingWorkoutHeader];
                w.name = document.getElementById('hName').value || w.name;
                w.subtitle = document.getElementById('hSub').value || w.subtitle;
                this.save(); this.editingWorkoutHeader = null; this.render();
            }

            saveExEdit() {
                const workout = this.workouts[this.editingExercise.workoutId];
                const ex = workout.exercises.find(e => e.id === this.editingExercise.exercise.id);
                ex.name = document.getElementById('editExName').value;
                ex.sets = parseInt(document.getElementById('editExSets').value);
                ex.reps = document.getElementById('editExReps').value;
                this.save(); this.editingExercise = null; this.render();
            }

            addExercise(workoutId) {
                this.workouts[workoutId].exercises.push({ id: Date.now().toString(), name: 'New Exercise', sets: 3, reps: '10', muscle: 'Target' });
                this.save(); this.render();
            }

            deleteExercise(wId, eId) {
                if(confirm('Delete this exercise?')) {
                    this.workouts[wId].exercises = this.workouts[wId].exercises.filter(e => e.id !== eId);
                    this.save(); this.render();
                }
            }

            saveDetailsAndBack() {
                this.workoutSession.exercises[this.activeExercise.id] = { 
                    weight: document.getElementById('weightInput').value, 
                    notes: document.getElementById('notesInput').value,
                    completed: true 
                };
                this.activeExercise = null; this.render();
            }

            toggleExerciseQuick(id, e) {
                e.stopPropagation();
                if (!this.workoutSession.exercises[id]) {
                    this.workoutSession.exercises[id] = { weight: '', notes: '', completed: true };
                } else {
                    this.workoutSession.exercises[id].completed = !this.workoutSession.exercises[id].completed;
                }
                this.render();
            }
        }

        const app = new GymApp();
    </script>
</body>
</html>
