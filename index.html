<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <title>Gym Tracker</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkd5bSBUcmFja2VyIiwKICAic2hvcnRfbmFtZSI6ICJHeW0iLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBmMTcyYSIsCiAgInRoZW1lX2NvbG9yIjogIiMzYjgyZjYiCn0=">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { overscroll-behavior: none; }
        .no-select { -webkit-user-select: none; user-select: none; }
    </style>
</head>
<body class="bg-slate-950 text-white">
    <div id="app"></div>

    <script>
        const defaultWorkouts = {
            upper1: {
                id: 'upper1',
                name: 'Upper 1',
                subtitle: 'Strength Focus',
                color: 'bg-red-500',
                exercises: [
                    { id: 'u1e1', name: 'Dumbbell Bench Press', sets: 4, reps: '6-8', rest: 180, muscle: 'Chest' },
                    { id: 'u1e2', name: 'Cable/Machine Row', sets: 4, reps: '6-8', rest: 180, muscle: 'Back' },
                    { id: 'u1e3', name: 'Overhead Press', sets: 3, reps: '8-10', rest: 120, muscle: 'Shoulders' },
                    { id: 'u1e4', name: 'Pull-ups/Lat Pulldown', sets: 3, reps: '8-10', rest: 120, muscle: 'Back' },
                    { id: 'u1e5', name: 'Dumbbell Curl', sets: 3, reps: '10-12', rest: 90, muscle: 'Biceps' },
                    { id: 'u1e6', name: 'Preacher Curl', sets: 3, reps: '10-12', rest: 90, muscle: 'Biceps' },
                    { id: 'u1e7', name: 'Tricep Dips', sets: 3, reps: '10-12', rest: 90, muscle: 'Triceps' },
                    { id: 'u1e8', name: 'Face Pulls', sets: 3, reps: '15-20', rest: 60, muscle: 'Rear Delts' }
                ]
            },
            lower1: {
                id: 'lower1',
                name: 'Lower 1',
                subtitle: 'Strength Focus',
                color: 'bg-blue-500',
                exercises: [
                    { id: 'l1e1', name: 'Belt Squat', sets: 4, reps: '6-8', rest: 180, muscle: 'Quads' },
                    { id: 'l1e2', name: 'Romanian Deadlift', sets: 3, reps: '8-10', rest: 180, muscle: 'Hamstrings' },
                    { id: 'l1e3', name: 'Leg Press', sets: 3, reps: '10-12', rest: 120, muscle: 'Quads' },
                    { id: 'l1e4', name: 'Leg Curl', sets: 3, reps: '10-12', rest: 90, muscle: 'Hamstrings' },
                    { id: 'l1e5', name: 'Walking Lunges', sets: 3, reps: '12 each', rest: 90, muscle: 'Quads/Glutes' },
                    { id: 'l1e6', name: 'Standing Calf Raise', sets: 4, reps: '12-15', rest: 60, muscle: 'Calves' },
                    { id: 'l1e7', name: 'Plank', sets: 3, reps: '60s', rest: 60, muscle: 'Core' }
                ]
            },
            plyo: {
                id: 'plyo',
                name: 'Plyo/Power',
                subtitle: 'Conditioning',
                color: 'bg-purple-500',
                exercises: [
                    { id: 'p1', name: 'Box Jumps', sets: 4, reps: '8', rest: 120, muscle: 'Power' },
                    { id: 'p2', name: 'Plyometric Push-ups', sets: 3, reps: '10', rest: 90, muscle: 'Upper Power' },
                    { id: 'p3', name: 'Lateral Jumps', sets: 3, reps: '10 each', rest: 90, muscle: 'Power' },
                    { id: 'p4', name: 'Burpees', sets: 4, reps: '15', rest: 90, muscle: 'Conditioning' },
                    { id: 'p5', name: 'Ladder Drills (High Knees)', sets: 4, reps: '20 yards', rest: 60, muscle: 'Agility' },
                    { id: 'p6', name: 'Ladder Drills (In-Out)', sets: 4, reps: '20 yards', rest: 60, muscle: 'Agility' },
                    { id: 'p7', name: 'Broad Jumps', sets: 3, reps: '8', rest: 120, muscle: 'Power' },
                    { id: 'p8', name: 'Medicine Ball Slams', sets: 3, reps: '12', rest: 60, muscle: 'Power' },
                    { id: 'p9', name: 'Sprint Intervals', sets: 6, reps: '50m', rest: 180, muscle: 'Speed' },
                    { id: 'p10', name: 'Jump Rope', sets: 3, reps: '60s', rest: 60, muscle: 'Conditioning' }
                ]
            },
            upper2: {
                id: 'upper2',
                name: 'Upper 2',
                subtitle: 'Hypertrophy Focus',
                color: 'bg-orange-500',
                exercises: [
                    { id: 'u2e1', name: 'Incline Dumbbell Press', sets: 4, reps: '10-12', rest: 120, muscle: 'Chest' },
                    { id: 'u2e2', name: 'Cable Row', sets: 4, reps: '10-12', rest: 120, muscle: 'Back' },
                    { id: 'u2e3', name: 'Dumbbell Shoulder Press', sets: 3, reps: '10-12', rest: 90, muscle: 'Shoulders' },
                    { id: 'u2e4', name: 'Lat Pulldown (Wide)', sets: 3, reps: '12-15', rest: 90, muscle: 'Back' },
                    { id: 'u2e5', name: 'Cable Flyes', sets: 3, reps: '12-15', rest: 60, muscle: 'Chest' },
                    { id: 'u2e6', name: 'Hammer Curls', sets: 3, reps: '12-15', rest: 60, muscle: 'Biceps' },
                    { id: 'u2e7', name: 'Cable Curl', sets: 3, reps: '12-15', rest: 60, muscle: 'Biceps' },
                    { id: 'u2e8', name: 'Overhead Tricep Extension', sets: 3, reps: '12-15', rest: 60, muscle: 'Triceps' }
                ]
            },
            lower2: {
                id: 'lower2',
                name: 'Lower 2',
                subtitle: 'Hypertrophy Focus',
                color: 'bg-green-500',
                exercises: [
                    { id: 'l2e1', name: 'Belt Squat', sets: 4, reps: '10-12', rest: 120, muscle: 'Quads' },
                    { id: 'l2e2', name: 'Leg Extension', sets: 4, reps: '12-15', rest: 90, muscle: 'Quads' },
                    { id: 'l2e3', name: 'Bulgarian Split Squat', sets: 3, reps: '10-12 each', rest: 90, muscle: 'Quads/Glutes' },
                    { id: 'l2e4', name: 'Leg Press', sets: 3, reps: '12-15', rest: 90, muscle: 'Quads' },
                    { id: 'l2e5', name: 'Seated Leg Curl', sets: 3, reps: '12-15', rest: 90, muscle: 'Hamstrings' },
                    { id: 'l2e6', name: 'Seated Calf Raise', sets: 4, reps: '15-20', rest: 60, muscle: 'Calves' },
                    { id: 'l2e7', name: 'Hanging Leg Raise', sets: 3, reps: '12-15', rest: 60, muscle: 'Core' }
                ]
            }
        };

        class GymApp {
            constructor() {
                this.workouts = JSON.parse(localStorage.getItem('gymWorkouts')) || defaultWorkouts;
                this.workoutHistory = JSON.parse(localStorage.getItem('gymHistory')) || [];
                this.currentWorkout = null;
                this.activeExercise = null;
                this.workoutSession = null;
                this.editMode = false;
                this.editingExercise = null;
                this.showMenu = false;
                this.render();
            }

            save() {
                localStorage.setItem('gymWorkouts', JSON.stringify(this.workouts));
                localStorage.setItem('gymHistory', JSON.stringify(this.workoutHistory));
            }

            startWorkout(workoutId) {
                this.currentWorkout = this.workouts[workoutId];
                this.workoutSession = {
                    startTime: new Date().toISOString(),
                    workoutId: workoutId,
                    exercises: {}
                };
                this.render();
            }

            logExercise(exerciseId, data) {
                this.workoutSession.exercises[exerciseId] = data;
                this.render();
            }

            toggleExerciseComplete(exerciseId, e) {
                e.stopPropagation();
                const currentData = this.workoutSession.exercises[exerciseId];
                const exercise = this.currentWorkout.exercises.find(ex => ex.id === exerciseId);
                
                if (!currentData) {
                    this.logExercise(exerciseId, {
                        weight: '',
                        completedSets: Array(exercise.sets).fill(true),
                        notes: ''
                    });
                } else {
                    const allComplete = currentData.completedSets.every(s => s);
                    this.logExercise(exerciseId, {
                        ...currentData,
                        completedSets: Array(exercise.sets).fill(!allComplete)
                    });
                }
            }

            finishWorkout() {
                const history = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    workoutName: this.currentWorkout.name,
                    duration: Math.round((new Date() - new Date(this.workoutSession.startTime)) / 60000),
                    exercises: this.workoutSession.exercises
                };
                this.workoutHistory = [history, ...this.workoutHistory];
                this.save();
                this.currentWorkout = null;
                this.workoutSession = null;
                this.activeExercise = null;
                this.render();
            }

            addExercise(workoutId) {
                const newExercise = {
                    id: Date.now().toString(),
                    name: 'New Exercise',
                    sets: 3,
                    reps: '10-12',
                    rest: 90,
                    muscle: 'Muscle Group'
                };
                this.workouts[workoutId].exercises.push(newExercise);
                this.save();
                this.render();
            }

            deleteExercise(workoutId, exerciseId) {
                this.workouts[workoutId].exercises = this.workouts[workoutId].exercises.filter(ex => ex.id !== exerciseId);
                this.save();
                this.render();
            }

            updateExercise(workoutId, exerciseId, updates) {
                const workout = this.workouts[workoutId];
                const exerciseIndex = workout.exercises.findIndex(ex => ex.id === exerciseId);
                workout.exercises[exerciseIndex] = { ...workout.exercises[exerciseIndex], ...updates };
                this.save();
                this.render();
            }

            render() {
                const app = document.getElementById('app');
                
                if (this.editingExercise) {
                    app.innerHTML = this.renderEditModal();
                } else if (this.activeExercise) {
                    app.innerHTML = this.renderExerciseDetail();
                } else if (this.currentWorkout) {
                    app.innerHTML = this.renderWorkoutList();
                } else {
                    app.innerHTML = this.renderHome();
                }
                
                this.attachEventListeners();
            }

            renderHome() {
                const workoutCards = Object.values(this.workouts).map(workout => `
                    <div class="bg-slate-800 rounded-xl overflow-hidden">
                        <button onclick="app.startWorkout('${workout.id}')" 
                                class="w-full p-5 text-left hover:bg-slate-700 transition-all ${this.editMode ? 'pointer-events-none' : ''}">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="${workout.color} w-12 h-12 rounded-lg flex items-center justify-center">
                                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6.5 6.5 11 11m-1-11-9 9"/></svg>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold">${workout.name}</h3>
                                        <p class="text-slate-400 text-sm">${workout.subtitle}</p>
                                        <p class="text-slate-500 text-xs mt-1">${workout.exercises.length} exercises</p>
                                    </div>
                                </div>
                                ${!this.editMode ? '<svg width="24" height="24" class="text-slate-600" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>' : ''}
                            </div>
                        </button>
                        ${this.editMode ? this.renderEditExercises(workout) : ''}
                    </div>
                `).join('');

                const historyHTML = this.workoutHistory.length > 0 ? `
                    <div class="p-4 mt-6">
                        <h2 class="text-xl font-bold mb-3 flex items-center gap-2">
                            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            Recent Workouts
                        </h2>
                        <div class="space-y-2">
                            ${this.workoutHistory.slice(0, 10).map(w => `
                                <div class="bg-slate-800 rounded-lg p-4">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h3 class="font-semibold">${w.workoutName}</h3>
                                            <p class="text-slate-400 text-sm">${new Date(w.date).toLocaleDateString()} • ${w.duration}min</p>
                                        </div>
                                        <svg width="20" height="20" class="text-green-500" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : '';

                return `
                    <div class="min-h-screen bg-slate-950 text-white pb-20">
                        <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6 pb-8">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6.5 6.5 11 11m-1-11-9 9"/></svg>
                                    <h1 class="text-3xl font-bold">Gym Tracker</h1>
                                </div>
                                <button onclick="app.showMenu = !app.showMenu; app.render()" class="text-white">
                                    <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                                </button>
                            </div>
                            <p class="text-blue-100">5-Day Split Program</p>
                        </div>

                        ${this.showMenu ? `
                            <div class="bg-slate-900 border-b border-slate-800 p-4">
                                <button onclick="app.editMode = !app.editMode; app.showMenu = false; app.render()"
                                        class="w-full bg-slate-800 text-white p-3 rounded-lg flex items-center justify-center gap-2">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                    ${this.editMode ? 'Done Editing' : 'Edit Workouts'}
                                </button>
                            </div>
                        ` : ''}

                        <div class="p-4 space-y-3 -mt-4">
                            ${workoutCards}
                        </div>

                        ${historyHTML}
                    </div>
                `;
            }

            renderEditExercises(workout) {
                return `
                    <div class="p-4 bg-slate-900 space-y-2">
                        ${workout.exercises.map(ex => `
                            <div class="flex items-center justify-between bg-slate-800 p-3 rounded-lg">
                                <div class="flex-1">
                                    <div class="text-white font-medium">${ex.name}</div>
                                    <div class="text-slate-400 text-sm">${ex.sets}x${ex.reps}</div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="app.editingExercise = { workoutId: '${workout.id}', exercise: ${JSON.stringify(ex).replace(/"/g, '&quot;')} }; app.render()"
                                            class="text-blue-400 p-2">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                    </button>
                                    <button onclick="app.deleteExercise('${workout.id}', '${ex.id}')"
                                            class="text-red-400 p-2">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                        <button onclick="app.addExercise('${workout.id}')"
                                class="w-full bg-blue-600 text-white p-3 rounded-lg flex items-center justify-center gap-2">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Add Exercise
                        </button>
                    </div>
                `;
            }

            renderWorkoutList() {
                const exerciseCards = this.currentWorkout.exercises.map(exercise => {
                    const sessionData = this.workoutSession.exercises[exercise.id];
                    const completedCount = sessionData?.completedSets.filter(Boolean).length || 0;
                    const isComplete = completedCount === exercise.sets;

                    return `
                        <div class="w-full bg-slate-800 rounded-xl p-4 flex items-center gap-4">
                            <button onclick="app.activeExercise = ${JSON.stringify(exercise).replace(/"/g, '&quot;')}; app.render()"
                                    class="flex-1 text-left">
                                <div class="mb-2">
                                    <h3 class="font-bold text-lg">${exercise.name}</h3>
                                    <p class="text-slate-400 text-sm">${exercise.muscle}</p>
                                </div>
                                <div class="flex gap-4 text-sm text-slate-400">
                                    <span>${exercise.sets} sets</span>
                                    <span>${exercise.reps} reps</span>
                                    <span>${exercise.rest}s rest</span>
                                </div>
                            </button>
                            <button onclick="app.toggleExerciseComplete('${exercise.id}', event)" class="flex-shrink-0 p-2">
                                ${isComplete ? 
                                    '<svg width="32" height="32" class="text-green-500" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>' :
                                    '<svg width="32" height="32" class="text-slate-600" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>'
                                }
                            </button>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="min-h-screen bg-slate-950 text-white pb-24">
                        <div class="${this.currentWorkout.color} p-6">
                            <button onclick="app.currentWorkout = null; app.workoutSession = null; app.render()" 
                                    class="mb-4 text-white">← Cancel Workout</button>
                            <h1 class="text-3xl font-bold">${this.currentWorkout.name}</h1>
                            <p class="text-white/80">${this.currentWorkout.subtitle}</p>
                        </div>
                        <div class="p-4 space-y-3">${exerciseCards}</div>
                        <div class="fixed bottom-0 left-0 right-0 p-4 bg-slate-900 border-t border-slate-800">
                            <button onclick="app.finishWorkout()"
                                    class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl">
                                Finish Workout
                            </button>
                        </div>
                    </div>
                `;
            }

            renderExerciseDetail() {
                const sessionData = this.workoutSession.exercises[this.activeExercise.id] || {
                    weight: '',
                    completedSets: Array(this.activeExercise.sets).fill(false),
                    notes: ''
                };

                const setButtons = Array.from({length: this.activeExercise.sets}, (_, i) => `
                    <button onclick="app.toggleSet('${this.activeExercise.id}', ${i})"
                            class="w-full p-4 rounded-lg flex items-center justify-between transition-all ${
                                sessionData.completedSets[i] ? 'bg-green-600' : 'bg-slate-700'
                            }">
                        <span class="font-semibold">Set ${i + 1}</span>
                        <span>${this.activeExercise.reps} reps</span>
                        ${sessionData.completedSets[i] ? '<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>' : ''}
                    </button>
                `).join('');

                return `
                    <div class="min-h-screen bg-slate-950 text-white pb-24">
                        <div class="${this.currentWorkout.color} p-6">
                            <button onclick="app.activeExercise = null; app.render()" 
                                    class="mb-4 text-white">← Back</button>
                            <h1 class="text-2xl font-bold">${this.activeExercise.name}</h1>
                            <p class="text-white/80">${this.activeExercise.muscle}</p>
                            <div class="flex gap-4 mt-3 text-sm">
                                <span>${this.activeExercise.sets} sets</span>
                                <span>${this.activeExercise.reps} reps</span>
                                <span>${this.activeExercise.rest}s rest</span>
                            </div>
                        </div>
                        <div class="p-4 space-y-6">
                            <div class="bg-slate-800 rounded-xl p-4">
                                <label class="block text-sm font-semibold mb-2">Weight (kg)</label>
                                <input type="number" inputmode="decimal" placeholder="Enter weight"
                                       id="weightInput" value="${sessionData.weight}"
                                       class="w-full bg-slate-700 text-white text-xl p-3 rounded-lg">
                            </div>
                            <div class="bg-slate-800 rounded-xl p-4">
                                <h3 class="font-semibold mb-3">Sets</h3>
                                <div class="space-y-2">${setButtons}</div>
                            </div>
                            <div class="bg-slate-800 rounded-xl p-4">
                                <label class="block text-sm font-semibold mb-2">Notes</label>
                                <textarea placeholder="How did it feel?" id="notesInput"
                                          class="w-full bg-slate-700 text-white p-3 rounded-lg h-24 resize-none">${sessionData.notes}</textarea>
                            </div>
                        </div>
                        <div class="fixed bottom-0 left-0 right-0 p-4 bg-slate-900 border-t border-slate-800">
                            <button onclick="app.nextExercise()"
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl">
                                Next Exercise
                            </button>
                        </div>
                    </div>
                `;
            }

            renderEditModal() {
                return `
                    <div class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
                        <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-white">Edit Exercise</h2>
                                <button onclick="app.editingExercise = null; app.render()" class="text-slate-400">
                                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm text-slate-400 mb-1">Exercise Name</label>
                                    <input type="text" id="editName" value="${this.editingExercise.exercise.name}"
                                           class="w-full bg-slate-700 text-white p-3 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm text-slate-400 mb-1">Muscle Group</label>
                                    <input type="text" id="editMuscle" value="${this.editingExercise.exercise.muscle}"
                                           class="w-full bg-slate-700 text-white p-3 rounded-lg">
                                </div>
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <label class="block text-sm text-slate-400 mb-1">Sets</label>
                                        <input type="number" id="editSets" value="${this.editingExercise.exercise.sets}"
                                               class="w-full bg-slate-700 text-white p-3 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-slate-400 mb-1">Reps</label>
                                        <input type="text" id="editReps" value="${this.editingExercise.exercise.reps}"
                                               class="w-full bg-slate-700 text-white p-3 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-slate-400 mb-1">Rest (s)</label>
                                        <input type="number" id="editRest" value="${this.editingExercise.exercise.rest}"
                                               class="w-full bg-slate-700 text-white p-3 rounded-lg">
                                    </div>
                                </div>
                                <button onclick="app.saveEdit()"
                                        class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                                    Save Changes
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            toggleSet(exerciseId, setNum) {
                const sessionData = this.workoutSession.exercises[exerciseId] || {
                    weight: '',
                    completedSets: Array(this.activeExercise.sets).fill(false),
                    notes: ''
                };
                sessionData.completedSets[setNum] = !sessionData.completedSets[setNum];
                this.logExercise(exerciseId, sessionData);
            }

            nextExercise() {
                const currentIdx = this.currentWorkout.exercises.findIndex(e => e.id === this.activeExercise.id);
                if (currentIdx < this.currentWorkout.exercises.length - 1) {
                    this.activeExercise = this.currentWorkout.exercises[currentIdx + 1];
                } else {
                    this.activeExercise = null;
                }
                this.render();
            }

            saveEdit() {
                const name = document.getElementById('editName').value;
                const muscle = document.getElementById('editMuscle').value;
                const sets = parseInt(document.getElementById('editSets').value);
                const reps = document.getElementById('editReps').value;
                const rest = parseInt(document.getElementById('editRest').value);
                
                this.updateExercise(this.editingExercise.workoutId, this.editingExercise.exercise.id, {
                    name, muscle, sets, reps, rest
                });
                this.editingExercise = null;
                this.render();
            }

            attachEventListeners() {
                const weightInput = document.getElementById('weightInput');
                const notesInput = document.getElementById('notesInput');
                
                if (weightInput && this.activeExercise) {
                    weightInput.addEventListener('input', (e) => {
                        const sessionData = this.workoutSession.exercises[this.activeExercise.id] || {
                            weight: '',
                            completedSets: Array(this.activeExercise.sets).fill(false),
                            notes: ''
                        };
                        sessionData.weight = e.target.value;
                        this.logExercise(this.activeExercise.id, sessionData);
                    });
                }
                
                if (notesInput && this.activeExercise) {
                    notesInput.addEventListener('input', (e) => {
                        const sessionData = this.workoutSession.exercises[this.activeExercise.id] || {
                            weight: '',
                            completedSets: Array(this.activeExercise.sets).fill(false),
                            notes: ''
                        };
                        sessionData.notes = e.target.value;
                        this.logExercise(this.activeExercise.id, sessionData);
                    });
                }
            }
        }

        const app = new GymApp();
    </script>
</body>
</html>
